<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>datamapper_dm-core3</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>the lazy load because without it, the above example would have only executed one query. This extra bit of laziness can come in very handy, for example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb1-1" data-line-number="1">  animals     = <span class="dt">Animal</span>.all</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  description = <span class="st">&#39;foo&#39;</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  animals.each <span class="kw">do</span> |animal|</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">    animal.update(<span class="st">:description</span> =&gt; description)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="kw">end</span></a></code></pre></div>
<p>In the above example, the Animals won’t be retrieved until you actually need them. This comes in handy in cases where you initialize the collection before you know if you need it, like in a web app controller.</p>
<h2 id="collection-chaining">Collection Chaining</h2>
<p>DataMapper’s lazy collections are also handy because you can get the same effect as named scopes, without any special syntax, eg:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" data-line-number="1">  <span class="kw">class</span> <span class="dt">Animal</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">    <span class="co"># ... setup ...</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">    <span class="kw">def</span> <span class="dv">self</span>.mammals</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">      all(<span class="st">:mammal</span> =&gt; <span class="dv">true</span>)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">    <span class="kw">def</span> <span class="dv">self</span>.zoo(zoo)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">      all(<span class="st">:zoo</span> =&gt; zoo)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">  zoo = <span class="dt">Zoo</span>.first(<span class="st">:name</span> =&gt; <span class="st">&#39;Greater Vancouver Zoo&#39;</span>)</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"></a>
<a class="sourceLine" id="cb2-15" data-line-number="15">  <span class="dt">Animal</span>.mammals.zoo(zoo).to_a  <span class="co"># =&gt; executes one query</span></a></code></pre></div>
<p>In the above example, we ask the Animal model for all the mammals, and then all the animals in a specific zoo, and DataMapper will chain the collection queries together and execute a single query to retrieve the matching records. There’s no special syntax, and no custom DSLs to learn, it’s just plain ruby all the way down.</p>
<p>You can even use this on association collections, eg:</p>
<p>``` ruby</p>
</body>
</html>
