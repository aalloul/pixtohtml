<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>ismasan_hash_mapper6</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>```</p>
<p>But HashMapper’s nested mappers will actually do that for you if a value is an array, so:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb1-1" data-line-number="1">map from(<span class="st">&#39;/employees&#39;</span>), to(<span class="st">&#39;employees&#39;</span>), <span class="st">using: </span><span class="dt">UserMapper</span></a></code></pre></div>
<p>… Will map each employee using UserMapper.</p>
<h4 id="before-and-after-filters">Before and after filters</h4>
<p>Sometimes you will need some slightly more complex processing on the whole hash, either before or after normalizing/denormalizing.</p>
<p>For this you can use the class methods before_normalize, before_denormalize, after_normalize and after_denormalize.</p>
<p>They all yield a block with 2 arguments - the hash you are mapping from and the hash you are mapping to, e.g.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">class</span> <span class="dt">EggMapper</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  map from(<span class="st">&#39;/raw&#39;</span>), to(<span class="st">&#39;/fried&#39;</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  before_normalize <span class="kw">do</span> |input, output|</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">    input[<span class="st">&#39;raw&#39;</span>] ||= <span class="st">&#39;please&#39;</span>     <span class="co"># this will give &#39;raw&#39; a default value </span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">    input</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  after_denormalize <span class="kw">do</span> |input, output|</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">    output.to_a        <span class="co"># the denormalized object will now be an array, not a hash!!</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="kw">end</span></a></code></pre></div>
<p>Important: note that for before filters, you need to return the (modified) input, and for after filters, you need to return the output. Note also that ‘output’ is correct at the time of the filter, i.e. before_normalize yields ‘output’ as an empty hash, while after_normalize yields it as an already normalized hash.</p>
<p>It is possible to define multiple filters of a given type. These are run in the order in which they are defined. A common use case might be to define a <code>before_normalize</code> filter in a parent class and a child class. The output from the previous invocation of the filter is passed as the input of the next invocation.</p>
<p>You can pass one extra argument to before and after filters if you need to: ```ruby class EggMapper map from(‘/raw’), to(‘/fried’)</p>
<p>before_normalize do |input, output, opts| input[‘raw’] ||= ‘please’ unless opts[:no_default] # this will give ‘raw’ a default value input end</p>
<p>after_denormalize do |input, output, opts| output.to_a # the denormalized object will now be an array, not a hash!!</p>
</body>
</html>
