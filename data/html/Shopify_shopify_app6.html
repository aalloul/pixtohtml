<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Shopify_shopify_app6</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>config.webhooks = [ {topic: ‘carts/update’, address: ‘https://example-app.com/webhooks/carts_update’} ] end ```</p>
<p>When the oauth callback is completed successfully ShopifyApp will queue a background job which will ensure all the specified webhooks exist for that shop. Because this runs on every oauth callback it means your app will always have the webhooks it needs even if the user uninstalls and re-installs the app.</p>
<p>ShopifyApp also provides a WebhooksController that receives webhooks and queues a job based on the received topic. For example if you register the webhook from above then all you need to do is create a job called <code>CartsUpdateJob</code>. The job will be queued with 2 params: <code>shop_domain</code> and <code>webhook</code> (which is the webhook body).</p>
<p>If you would like to namespace your jobs you may set <code>webhook_jobs_namespace</code> in the config. For example if your app handles webhooks from other ecommerce applications as well, and you want Shopify cart update webhooks to be processed by a job living in <code>jobs/shopify/webhooks/carts_update_job.rb</code> rather than <code>jobs/carts_update_job.rb</code>):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="dt">ShopifyApp</span>.configure <span class="kw">do</span> |config|</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  config.webhook_jobs_namespace = <span class="st">&#39;shopify/webhooks&#39;</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">end</span></a></code></pre></div>
<p>If you are only interested in particular fields, you can optionally filter the data sent by Shopify by specifying the <code>fields</code> parameter in <code>config/webhooks</code>. Note that you will still receive a webhook request from Shopify every time the resource is updated, but only the specified fields will be sent.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="dt">ShopifyApp</span>.configure <span class="kw">do</span> |config|</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  config.webhooks = [</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    {<span class="st">topic: &#39;products/update&#39;</span>, <span class="st">address: &#39;https://example-app.com/webhooks/products_update&#39;</span>, <span class="st">fields: </span>[<span class="st">&#39;title&#39;</span>, <span class="st">&#39;vendor&#39;</span>]}</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  ]</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw">end</span></a></code></pre></div>
<p>If you’d rather implement your own controller then you’ll want to use the WebhookVerfication module to verify your webhooks, example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">class</span> <span class="dt">CustomWebhooksController</span> &lt; <span class="dt">ApplicationController</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  include <span class="dt">ShopifyApp</span>::<span class="dt">WebhookVerification</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  <span class="kw">def</span> carts_update</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    params.permit!</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    <span class="dt">SomeJob</span>.perform_later(<span class="st">shop_domain: </span>shop_domain, <span class="st">webhook: </span>webhook_params.to_h)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">    head <span class="st">:no_content</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  <span class="kw">private</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">  <span class="kw">def</span> webhook_params</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    params.except(<span class="st">:controller</span>, <span class="st">:action</span>, <span class="st">:type</span>)</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="kw">end</span></a></code></pre></div>
<p>The module skips the <code>verify_authenticity_token</code> before_action and adds an action to verify that the webhook came from Shopify. You can now add a post route to your application pointing to the controller and action to accept the webhook data from Shopify.</p>
</body>
</html>
