<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>camptocamp_puppet-tomcat3</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>Pre-requisites:</p>
<pre><code>include apache_c2c

apache_c2c::module {&#39;proxy_ajp&#39;:
  ensure  =&gt; present,
}

apache_c2c::vhost {&#39;www.mycompany.com&#39;:
  ensure =&gt; present,
}</code></pre>
<p>Create a tomcat instance which is accessible via Apache using AJP on a given virtualhost:</p>
<pre><code>include tomcat

tomcat::instance {&#39;myapp&#39;:
  ensure      =&gt; present,
  ajp_port    =&gt; &#39;8000&#39;
}

apache_c2c::proxypass {&#39;myapp&#39;:
  ensure   =&gt; present,
  location =&gt; &#39;/myapp&#39;,
  vhost    =&gt; &#39;www.mycompany.com&#39;,
  url      =&gt; &#39;ajp://localhost:8000&#39;,
}</code></pre>
<h2 id="multiple-instances">Multiple instances</h2>
<p>If you create multiple Tomcat instances, you must avoid port clash by setting distinct ports for each instance:</p>
<pre><code>include tomcat

tomcat::instance {&#39;tomcat1&#39;:
  ensure      =&gt; present,
  server_port =&gt; &#39;8005&#39;,
  http_port   =&gt; &#39;8080&#39;,
  ajp_port    =&gt; &#39;8009&#39;,
}

tomcat::instance {&#39;tomcat2&#39;:
  ensure      =&gt; present,
  server_port =&gt; &#39;8006&#39;,
  http_port   =&gt; &#39;8081&#39;,
  ajp_port    =&gt; &#39;8010&#39;,</code></pre>
</body>
</html>
