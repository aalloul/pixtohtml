<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>langalex_totally-restful-authorization1</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h2 id="totally-restful-authorization">totally restful authorization</h2>
<p>This plugin adds an authorization layer to your rails app that is <del>completely</del> totally transparent to your restful controllers. All you have to is call a macro in your controller and provide 4 methods (or use provided macros again) in your model that control who is allowed to access it or not. The controllers will then automatically block or allow the usual CRUD actions (new, create, edit, update, show, destroy) to run or not.</p>
<h3 id="how-it-works">How it works</h3>
<p>Call <em>check_authorization</em> in your restful controller…</p>
<pre><code>class ApplicationController &lt; ActionController::Base
  check_authorization
end</code></pre>
<p>… and then declare the permissions in your model:</p>
<pre><code>class User
    updatable_by :admin # updatable if updater.admin? return true
    updatable_by :admin, :only =&gt; [:description] # only allow some attribute to be updated
    updatable_by :self # special role self, allows the object to update itself
    updatable_by :associated =&gt; :friend # allow user.friend to update the object

    viewable_by :anyone # special role, includes nil
    viewable_by :admin, :condition =&gt; lambda{|user, viewer| user.non_admin? &amp;&amp; viewer.account_activated?} # use conditions for more complex permissions



    destroyable_by [:admin, :root] # declare multiple roles at once
end</code></pre>
<p>Or implement one or more of these four methods directly:</p>
<pre><code>class User
  def updatable_by?(user, parameters = {})
    true
  end

  def creatable_by?(user, parameters = {})
    true
  end

  def destroyable_by?(user)
    true
  end

  def   viewable_by?(user)
    true
  end
end</code></pre>
<p>The user parameter is taken from the current_user in your controller (so you have to provide a current_user method, or install clearance/authlogic or something like that).</p>
</body>
</html>
