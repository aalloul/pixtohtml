<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>raganwald-deprecated_rewrite_rails2</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>RewriteRails takes your <code>.rr</code> files and scans them with <em>rewriters</em>. Each rewriter looks for a certain kind of Ruby code and rewrites it into another kind of Ruby code. This produces the same effect as a C Preprocessor, a C++ template, or a Lisp Macro.</p>
<p>By default, the rewritten files are stored in the <code>rewritten</code> directory of your project. So if you create a file called <code>foo.rr</code> in <code>lib</code> directory, you will find a file called <code>foo.rb</code> in <code>rewritten/lib</code>. This means you can always see what RewriteRails is doing, and if you want to stop using it you have 100% working Ruby files.</p>
<p>RewriteRails also tells Rails to look in the <code>rewritten</code> folder for your code, so you don’t have to move anything around, it’s as if Rails is reading your <code>.rr</code> files directly.</p>
<p><strong>So is a <code>.rr</code> file something like an erb or haml template?</strong></p>
<p>Yes. And also No. Yes, it is like a template in that it is turned into a <code>.rb</code> file that Rails executes. But no in that you won’t find a bunch of special directives or any other trappings of a “template language.” <code>.rr</code> files are Ruby files, they look like they use a bunch of monkey-patched extensions, but RewriteRails rewrites them so that they only use Standard Ruby.</p>
<p>If you would like a metaphor, imagine that you embrace syntactic abstractions like <code>#andand</code>, but you have a colleague who dislikes monkey-patching intensely, so much so that every time you write some code like:</p>
<pre><code>Product.find(:first, ...).andand.update_attribute(:on_sale, true)</code></pre>
<p>Your colleague “fixes” it by rewriting it to:</p>
<pre><code>(first_product = Product.find(:first, ...) and first_product.update_attribute(:on_sale, true))</code></pre>
<p>The good news is that while your colleague’s rewriting destroys what you originally wrote, RewriteRails leaves your <code>.rr</code> files just the way it found them. So with RewriteRails, both you and your colleague can get along just fine.</p>
<p><strong>How can I see what is rewritten?</strong></p>
<p>After you write a <code>.rr</code> file, you can run your code in the normal way: <code>script/console</code>, <code>script/server</code>, or best of all <code>rake test</code> :-)</p>
<p>As mentioned, RewriteRails will place a <code>.rb</code> in the <code>rewritten</code> directory for each of your <code>.rr</code> files and you can open them up in a text editor. Like any generated file, you should not edit the rewritten files.</p>
<p><strong>How do I debug <code>.rr</code> files?</strong></p>
<p>Very carefully. At this time, the rewritten file does not contain any blank lines or comments, and obviously some of what you wrote is rewritten into a different form. As a result, the code you write may be on line 42 in your <code>.rr</code> file but end up on line 23 in the resulting <code>.rb</code> file. This can be tedious if you are dealing with a lot of errors and like your IDE’s ability to jump right to the offending line of source code.</p>
<p>TODO: Perform a little diff magic and modify each <code>.rb</code> file so that as many lines of code as possible end up on the same line number as in the original <code>.rr</code> file.</p>
<p><strong>My colleagues don’t mind me writing .rr files, but they prefer .rb files. What do we do?</strong></p>
<p>RewriteRails puts its generated <code>.rb</code> files in its own <code>rewritten</code> directory, and ignores <code>.rb</code> files in Rails’ standard directories. So if your team prefers to have some <code>.rb</code> files and some <code>.rr</code> files, you know that the <code>.rb</code> files in Rails’ standard directories are all ok to edit as you see fit.</p>
<p>In other words, you can write <code>.rb</code> files whenever you want and as long as they are in Rails’ standard directories, they will behave exactly as you expect. You can mix <code>.rb</code> and <code>.rr</code> files as much as you like.</p>
<p><strong>I like this for development, but I don’t want to install all those gems on my server</strong></p>
<ol type="1">
<li>Run <code>rake rewrite:prepare</code>. This will recursively rewrite all of the <code>.rr</code> files in your project so that it is not necessary to run them in production.</li>
<li>Do not install the RewriteRails plugin on your server.</li>
<li>Open up <code>config/environments/production.rb</code> and add the following lines</li>
</ol>
<ul>
<li><code>config.load_paths += %W( #{RAILS_ROOT}/rewritten/app/controllers )</code></li>
<li><code>config.load_paths += %W( #{RAILS_ROOT}/rewritten/app/helpers )</code></li>
<li><code>config.load_paths += %W( #{RAILS_ROOT}/rewritten/app/models )</code></li>
<li><code>config.load_paths += %W( #{RAILS_ROOT}/rewritten/app/lib )</code></li>
<li>…and any other directories where you might place <code>.rr</code> files</li>
</ul>
<p>Now when you run your project in production, the <code>.rr</code> files will not be rewritten on the fly, but Rails will continue to find the rewritten <code>.rb</code> files in the <code>rewritten</code> directory. You don’t have to do anything else, you won’t need ParseTree, Ruby2Ruby, or RewriteRails on your production servers.</p>
</body>
</html>
