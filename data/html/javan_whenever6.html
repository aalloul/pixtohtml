<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>javan_whenever6</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>the crontabs on servers with one or more of the roles in that list.</p>
<p>Jobs with no :roles argument will be deployed to all servers in the whenever_roles list. This is to maintain backward compatibility with previous releases of whenever.</p>
<p>So, for example, with the default whenever_roles of <code>[:db]</code>, a job like this would be deployed to all servers with the <code>:db</code> role:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb1-1" data-line-number="1">every <span class="st">:day</span>, <span class="st">at: &#39;12:20am&#39;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  rake <span class="st">&#39;foo:bar&#39;</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">end</span></a></code></pre></div>
<p>If we set whenever_roles to <code>[:db, :app]</code> in deploy.rb, and have the following jobs in schedule.rb:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" data-line-number="1">every <span class="st">:day</span>, <span class="st">at: &#39;1:37pm&#39;</span>, <span class="st">roles: </span>[<span class="st">:app</span>] <span class="kw">do</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  rake <span class="st">&#39;app:task&#39;</span> <span class="co"># will only be added to crontabs of :app servers</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">end</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">every <span class="st">:hour</span>, <span class="st">roles: </span>[<span class="st">:db</span>] <span class="kw">do</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  rake <span class="st">&#39;db:task&#39;</span> <span class="co"># will only be added to crontabs of :db servers</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="kw">end</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">every <span class="st">:day</span>, <span class="st">at: &#39;12:02am&#39;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  command <span class="st">&quot;run_this_everywhere&quot;</span> <span class="co"># will be deployed to :db and :app servers</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="kw">end</span></a></code></pre></div>
<p>Here are the basic rules:</p>
<ol type="1">
<li>If a server’s role isn’t listed in whenever_roles, it will <em>never</em> have jobs added to its crontab.</li>
<li>If a server’s role is listed in the whenever_roles, then it will have all jobs added to its crontab that either list that role in their :roles arg or that don’t have a :roles arg.</li>
<li>If a job has a :roles arg but that role isn’t in the whenever_roles list, that job <em>will not</em> be deployed to any server.</li>
</ol>
<h3 id="rvm-integration">RVM Integration</h3>
<p>If your production environment uses RVM (Ruby Version Manager) you will run into a gotcha that causes your cron jobs to hang. This is not directly related to Whenever, and can be tricky to debug. Your .rvmrc files must be trusted or else the cron jobs will hang waiting for the file to be trusted. A solution is to disable the prompt by adding this line to your user rvm file in <code>~/.rvmrc</code></p>
<p><code>rvm_trust_rvmrcs_flag=1</code></p>
<p>This tells rvm to trust all rvmrc files.</p>
<h3 id="heroku">Heroku?</h3>
</body>
</html>
