<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>tonyg_extprot2</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>Here’s a trivial protocol definition:</p>
<pre><code>(* this is a comment (* and this a nested comment *) *)
message user = {
  id : int;
  name : string;
}</code></pre>
<p>The value</p>
<pre><code>{ id = 1; name = &quot;J.R.R. Tolkien&quot; }</code></pre>
<p>is serialized as this 21-byte message (output from <code>hexdump -C</code>)</p>
<pre><code>00000000  01 13 02 00 02 03 0e 4a  2e 52 2e 52 2e 20 54 6f  |.......J.R.R. To|
00000010  6c 6b 69 65 6e                                    |lkien|
00000015</code></pre>
<p>The code generated by extprotc allows you to manipulate such messages as any normal value. For instance, in the Ruby target (in progress as of 2008-11-04), you’d do:</p>
<pre><code># writing
puts &quot;About to save record for user #{user.name}&quot;
user.write(buf)
# save buf

# reading
user = User.read(io)
puts &quot;Got user #{user.id} #{user.name}&quot;</code></pre>
<p>In OCaml, the message is simply a record:</p>
<pre><code>let u = User.io_read_user stream in
  printf &quot;User %S has got id %d\n&quot; u.name u.id</code></pre>
<h2 id="usage">Usage</h2>
<ol type="1">
<li><p>Write a <a href="doc/protocol-definition.md">protocol definition using extprot’s abstract syntax</a>: myprotocol.proto</p></li>
<li><p>Run the extprotc compiler to generate <a href="doc/language-mapping.md">the code needed to read, write, and inspect the messages defined in the protocol</a>: <code>extprotc myprotocol.proto</code> (generates the code, e.g. <code>myprotocol.ml</code> for OCaml). More <a href="doc/language-mapping.md">information about the generated code can be found here</a>.</p></li>
<li><p>Use it from your application code.</p></li>
</ol>
</body>
</html>
