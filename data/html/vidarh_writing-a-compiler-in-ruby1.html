<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>vidarh_writing-a-compiler-in-ruby1</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="writing-a-ruby-compiler-in-ruby">Writing a (Ruby) compiler in Ruby</h1>
<p>Source for my series on writing a compiler in Ruby.</p>
<p>See http://www.hokstad.com/compiler</p>
<p><strong>NOTE</strong> This is still wildly incomplete.</p>
<h2 id="caveats">Caveats</h2>
<p>This section covers caveats about compiled Ruby vs. MRI, not generally missing pieces or bugs in the current state of the compiler (of which there are many).</p>
<h3 id="require">require</h3>
<p>Presently, “require” is evaluated statically at compile time.</p>
<p>This makes certain Ruby patterns hard or impossible to support. E.g. reading the contents of a directory and caling “require” for each .rb file found will not presently work, and may never work, as it is not clear in the context of compilation whether or not the intent is to load this file at compile time or runtime.</p>
<p>Ruby allows the argument to “require” to be dynamically generated. E.g. “require File.dirname(<strong>FILE</strong>) + ‘/blah’”. To facilitate compatibility, limited forms of this pattern may eventually be supported.</p>
<p>On MRI, “require” is generally overridden by a custom version for rubygems or bundler. This is not likely to ever be supported. “require” is likely to be treated as a keyword, rather than as an overrideable method.</p>
<h3 id="section">$0</h3>
<p>While <code>$0</code> will at some point be initialized with the name of the file compilation is triggered for, certain patterns of Ruby, such as conditionally executing code based on whether a given file is executed directly are conceptually different, given that $0 gets bound at <em>compile time</em>.</p>
<p>We’ll need to consider if the right behaviour is for <code>$0</code> and/or <code>__FILE__</code> to contain the equivalent of C’s <code>argv[0]</code> instead. Possibly make <code>$0</code> and <code>__FILE__</code> refer to different things.</p>
</body>
</html>
