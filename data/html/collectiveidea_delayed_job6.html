<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>collectiveidea_delayed_job6</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre><code># 2 workers for the mailers and tasks queues, and 2 workers for any jobs:
RAILS_ENV=production script/delayed_job --pool=tracking --pool=mailers,tasks:2 --pool=*:2 start

# Runs all available jobs and then exits
RAILS_ENV=production script/delayed_job start --exit-on-complete
# or to run in the foreground
RAILS_ENV=production script/delayed_job run --exit-on-complete</code></pre>
<p><strong>Rails 4:</strong> <em>replace script/delayed_job with bin/delayed_job</em></p>
<p>Workers can be running on any computer, as long as they have access to the database and their clock is in sync. Keep in mind that each worker will check the database at least every 5 seconds.</p>
<p>You can also invoke <code>rake jobs:work</code> which will start working off jobs. You can cancel the rake task with <code>CTRL-C</code>.</p>
<p>If you want to just run all available jobs and exit you can use <code>rake jobs:workoff</code></p>
<p>Work off queues by setting the <code>QUEUE</code> or <code>QUEUES</code> environment variable.</p>
<pre><code>QUEUE=tracking rake jobs:work
QUEUES=mailers,tasks rake jobs:work</code></pre>
<h1 id="restarting-delayed_job">Restarting delayed_job</h1>
<p>The following syntax will restart delayed jobs:</p>
<pre><code>RAILS_ENV=production script/delayed_job restart</code></pre>
<p>To restart multiple delayed_job workers:</p>
<pre><code>RAILS_ENV=production script/delayed_job -n2 restart</code></pre>
<p><strong>Rails 4:</strong> <em>replace script/delayed_job with bin/delayed_job</em></p>
<h1 id="custom-jobs">Custom Jobs</h1>
<p>Jobs are simple ruby objects with a method called perform. Any object which responds to perform can be stuffed into the jobs table. Job objects are serialized to yaml so that they can later be resurrected by the job runner.</p>
<p>```ruby NewsletterJob = Struct.new(:text, :emails) do def perform emails.each { |e| NewsletterMailer.deliver_text_to_email(text, e) } end end</p>
</body>
</html>
