<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>freerange_mocha5</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre><code>line_items.inject(0) { |total, line_item| total + line_item.price } + shipping_cost</code></pre>
<p>end</p>
<p>def total_weight line_items.inject(0) { |total, line_item| total + line_item.weight } end</p>
<p>def shipping_cost total_weight * 5 + 10 end</p>
<p>class &lt;&lt; self def find_all # Database.connection.execute(’select * from orders… end</p>
<pre><code>def number_shipped_since(date)
  find_all.select { |order| order.shipped_on &gt; date }.length
end

def unshipped_value
  find_all.inject(0) { |total, order| order.shipped_on ? total : total + order.total_cost }
end</code></pre>
<p>end end</p>
<p>require ‘test/unit’ require ‘mocha/test_unit’</p>
<p>class OrderTest &lt; Test::Unit::TestCase # illustrates stubbing instance method def test_should_calculate_shipping_cost_based_on_total_weight order = Order.new order.stubs(:total_weight).returns(10) assert_equal 60, order.shipping_cost end</p>
<p># illustrates stubbing class method def test_should_count_number_of_orders_shipped_after_specified_date now = Time.now; week_in_secs = 7 * 24 * 60 * 60 order_1 = Order.new; order_1.shipped_on = now - 1 * week_in_secs order_2 = Order.new; order_2.shipped_on = now - 3 * week_in_secs Order.stubs(:find_all).returns([order_1, order_2]) assert_equal 1, Order.number_shipped_since(now - 2 * week_in_secs) end</p>
<p># illustrates stubbing instance method for all instances of a class def test_should_calculate_value_of_unshipped_orders Order.stubs(:find_all).returns([Order.new, Order.new, Order.new]) Order.any_instance.stubs(:shipped_on).returns(nil)</p>
</body>
</html>
