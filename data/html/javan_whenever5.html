<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>javan_whenever5</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>```</p>
<p>The capistrano variable <code>:stage</code> should be the one holding your environment name. This will make the correct <code>:environment</code> available in your <code>schedule.rb</code>.</p>
<p>If both your environments are on the same server you’ll want to namespace them, or they’ll overwrite each other when you deploy:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb1-1" data-line-number="1">set <span class="st">:whenever_environment</span>, defer { stage }</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">set <span class="st">:whenever_identifier</span>, defer { <span class="st">&quot;</span><span class="ot">#{</span>application<span class="ot">}</span><span class="st">_</span><span class="ot">#{</span>stage<span class="ot">}</span><span class="st">&quot;</span> }</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">require <span class="st">&quot;whenever/capistrano&quot;</span></a></code></pre></div>
<p>If you use a schedule at an alternative path, you may configure it like so:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" data-line-number="1">set <span class="st">:whenever_load_file</span>, defer { <span class="st">&quot;</span><span class="ot">#{</span>release_path<span class="ot">}</span><span class="st">/somewhere/else/schedule.rb&quot;</span> }</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">require <span class="st">&quot;whenever/capistrano&quot;</span></a></code></pre></div>
<h3 id="capistrano-v3-integration">Capistrano V3 Integration</h3>
<p>In your “Capfile” file:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb3-1" data-line-number="1">require <span class="st">&quot;whenever/capistrano&quot;</span></a></code></pre></div>
<p>Take a look at the for options you can set. For example, to namespace the crontab entries by application and stage do this in your “config/deploy.rb” file:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb4-1" data-line-number="1">set <span class="st">:whenever_identifier</span>, -&gt;{ <span class="st">&quot;</span><span class="ot">#{</span>fetch(<span class="st">:application</span>)<span class="ot">}</span><span class="st">_</span><span class="ot">#{</span>fetch(<span class="st">:stage</span>)<span class="ot">}</span><span class="st">&quot;</span> }</a></code></pre></div>
<p>The Capistrano integration by default expects the <code>:application</code> variable to be set in order to scope jobs in the crontab.</p>
<h3 id="capistrano-roles">Capistrano roles</h3>
<p>The first thing to know about the new roles support is that it is entirely optional and backwards-compatible. If you don’t need different jobs running on different servers in your capistrano deployment, then you can safely stop reading now and everything should just work the same way it always has.</p>
<p>When you define a job in your schedule.rb file, by default it will be deployed to all servers in the whenever_roles list (which defaults to <code>[:db]</code>).</p>
<p>However, if you want to restrict certain jobs to only run on subset of servers, you can add a <code>roles: [...]</code> argument to their definitions. <strong>Make sure to add that role to the whenever_roles list in your deploy.rb.</strong></p>
<p>When you run <code>cap deploy</code>, jobs with a :roles list specified will only be added to</p>
</body>
</html>
