<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>kragen_dumbfts3</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>index segment, maybe a bit over 700 on average.</p>
<p>Now, actually, the above is a bit of a lie. Because this skip file is so large, it has a skip file of its own, which is only 1219 bytes. So rather than plow through the 1.3 mebibytes of the skip file looking for the term, we read through (about half of) the 29 entries in the skip file’s skip file, then read through up to 1400 or so entries somewhere in the middle of the main skip file, and then read through up to 1400 or so entries in the index segment itself. So that’s three seeks and a bit over 1400 entries of I/O, totaling about 50 kilobytes. My laptop disk transfers almost 9 megabytes per second, so that’s about 6ms of I/O bandwidth.</p>
<p>So to look up a single rare term in a single index segment is 6ms of data transfer, 30ms of seeking, and processing 1400 lines in Python, so somewhere around 30ms. To look up N rare terms in M index files is then N×M×30ms. Right now I have 10 index segments.</p>
<p>Once the posting lists have been fetched, they are intersected to get a list of search hits, which are messages that are then fetched from the mailbox file.</p>
<p>Looking up common terms is more expensive because the number of postings to process can far exceed the number of postings to sift through to find them. For example, something like 0.7% of my index files consist of postings for the word “from”, which occurs in every mail message. In the 2-gibibyte segment I was using as an example, there are presumably about 600 000 postings for the word “from”, consuming 14 mebibytes. Reading 14 mebibytes from disk is going to take almost two seconds by itself, let alone the time to parse them.</p>
<p>The index segments are plain ASCII text files (as long as the corpus is plain ASCII text), with one posting per line: first the lowercase version of the word itself, then the name of the header field in which the word was found (if any), then the byte offset in the mailbox where the message containing the posting begins. Here are some example postings from one of my index segments:</p>
<pre><code>headers 98697592
headers 99125817
headers x-asf-spam-status 47638180
headhunter 59154903
headhunter 65973658
headhunters 110711591</code></pre>
<p>This means that, for example, the message in my mailbox starting at byte 47638180 contains the word “headers” in the message header “X-ASF-Spam-Status”, probably as part of the phrase “tests=MISSING_HEADERS”.</p>
</body>
</html>
