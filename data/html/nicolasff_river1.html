<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>nicolasff_river1</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h4 id="compile">COMPILE</h4>
You need to fetch the http-parser submodule, by typing:
<pre>
git submodule init
git submodule update
</pre>
<h4 id="run-demo">Run demo</h4>
<p>1 - run <code>make clean all</code><br />
2 - run <code>./river</code></p>
3 - In a terminal, run:
<pre>
curl -N -d "name=public-channel" "http://127.0.0.1:9271/subscribe"
</pre>
<p>The call to <code>/subscribe</code> is blocking.</p>
4 - And then, in another terminal:
<pre>
curl -d "name=public-channel&data=hello-world-of-comet" "http://127.0.0.1:9271/publish"
</pre>
<p>5 - The call to <code>/subscribe</code> returns, with the data published in the channel.</p>
<h3 id="embed-in-an-html-page">Embed in an HTML page</h3>
<p>The following example considers the page to be at <code>example.com</code>, and the comet server at <code>river.example.com</code>.</p>
1 - Add a reference to the <code>lib.js</code> script in your page:
<pre>
    &lt;script type="text/javascript" src="http://river.example.com/lib.js?domain=example.com"&gt;&lt;/script&gt;
</pre>
2 - Initialize the server:
<pre>
    document.domain = "example.com";

    function onMsg(msg) {
        alert("received message: ", msg);
    }

    Comet.init(function() {
        var c = new Comet.Client();
        c.connect("public-channel", onMsg); // call onMsg upon reception of a message.
    });
</pre>
<p>3 - The <code>onMsg</code> function will now receive all messages published on <code>public-channel</code>.</p>
</body>
</html>
