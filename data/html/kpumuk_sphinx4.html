<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>kpumuk_sphinx4</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre><code>  ranking_mode :bm25
  id_range 10, 1000
end</code></pre>
<p>As you can see, in this case you can omit the <code>set_</code> prefix for this methods. If block accepts a parameter, sphinx instance will be passed into the block. In this case you should you full method names including the <code>set_</code> prefix:</p>
<pre><code>results = Sphinx::Client.new.query(&#39;test&#39;) do |sphinx|
  sphinx.set_match_mode :any
  sphinx.set_ranking_mode :bm25
  sphinx.set_id_range 10, 1000
end</code></pre>
<h2 id="example">Example</h2>
<p>This simple example illustrates base connection establishing, search results retrieving, and excerpts building. Please note how does it perform database select using ActiveRecord to save the order of records established by Sphinx.</p>
<pre><code>sphinx = Sphinx::Client.new
result = sphinx.query(&#39;test&#39;)
ids = result[&#39;matches&#39;].map { |match| match[&#39;id&#39;] }
posts = Post.all :conditions =&gt; { :id =&gt; ids },
                 :order =&gt; &quot;FIELD(id,#{ids.join(&#39;,&#39;)})&quot;

docs = posts.map(&amp;:body)
excerpts = sphinx.build_excerpts(docs, &#39;index&#39;, &#39;test&#39;)</code></pre>
<h2 id="logging">Logging</h2>
<p>You can ask Sphinx client API to log it’s activity to some log. In order to do that you can pass a logger object into the <code>Sphinx::Client</code> constructor:</p>
<pre><code>require &#39;logger&#39;
Sphinx::Client.new(Logger.new(STDOUT)).query(&#39;test&#39;)</code></pre>
<p>Logger object should respond to methods :debug, :info, and :warn, and accept blocks (this is what standard Ruby <code>Logger</code> class does). Here is what you will see in your log:</p>
<ul>
<li><code>DEBUG</code> – <code>query</code>, <code>add_query</code>, <code>run_queries</code> method calls with configured filters.</li>
<li><code>INFO</code> – initialization with Sphinx version, servers change, attempts to re-connect, and all attempts to do an API call with server where request being performed.</li>
<li><code>WARN</code> – various connection and socket errors.</li>
</ul>
</body>
</html>
