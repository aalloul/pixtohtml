<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>jeremyevans_fixture_dependencies7</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p><code>fruits.yml</code>:</p>
<pre><code>apple:
  id: 1
  name: Apple
  eater: george (Animal)</code></pre>
<p>In your test, use something like this:</p>
<pre><code>apple = load(:fruit__apple)
apple.eater.name.must_equal &quot;George&quot;</code></pre>
<p>fixture_dependencies will set the <code>eater</code> association in <code>Fruit</code> instance <code>george</code> instance of <code>Animal</code>.</p>
<h2 id="cyclic-dependencies">Cyclic dependencies</h2>
<p>fixture_dependencies handles almost all cyclic dependencies. It handles all has_many, has_one, and habtm cyclic dependencies. It handles all self-referential cyclic dependencies. It handles all belongs_to cyclic dependencies except the case where there is a NOT NULL or validates_presence of constraint on the cyclic dependency’s foreign key.</p>
<p>For example, a case that won’t work is when employee belongs_to supervisor (with a NOT NULL or validates_presence_of constraint on supervisor_id), and john is karl’s supervisor and karl is john’s supervisor. Since you can’t create john without a valid supervisor_id, you need to create karl first, but you can’t create karl for the same reason (as john doesn’t exist yet).</p>
<p>There isn’t a generic way to handle the belongs_to cyclic dependency, as far as I know. Deferring foreign key checks could work, but may not be enabled (and one of the main reasons to use the plugin is that it doesn’t require them). For associations like the example above (employee’s supervisor is also an employee), setting the foreign_key to the primary key and then changing it later is an option, but database checks may prevent it. For more complex cyclic dependencies involving multiple model classes (employee belongs_to division belongs_to head_of_division when the employee is a member of the division and also the head of the division), even that approach is not possible.</p>
<h2 id="known-issues">Known issues</h2>
<p>Currently, the plugin only supports YAML fixtures, but other types of fixtures would be fairly easy to add (send me a patch if you add support for another fixture type).</p>
<p>The plugin is significantly slower than the default testing method, because it</p>
</body>
</html>
