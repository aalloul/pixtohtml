<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>email-spec_email-spec4</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre><code>When I open the email
Then I should see &quot;confirm&quot; in the email body
When I follow &quot;confirm&quot; in the email
Then I should see &quot;Confirm your new account&quot;</code></pre>
<p>```</p>
<p>For more examples, check out examples/rails_root in the source for a small example app that implements these steps.</p>
<h3 id="cucumber-matchers-ruby">Cucumber Matchers (Ruby)</h3>
<p>See RSpec Matchers (they are the same)</p>
<h3 id="rspec">RSpec</h3>
<h4 id="testing-in-isolation">Testing In Isolation</h4>
<p>It is often useful to test your mailers in isolation. You can accomplish this by using mocks to verify that the mailer is being called in the correct place and then write focused examples for the actual mailer. This is a simple example from the sample app found in the gem:</p>
<p>Verify that the mailer is used correctly in the controller (this would apply to a model as well):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" data-line-number="1">describe <span class="st">&quot;POST /signup (#signup)&quot;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  it <span class="st">&quot;should deliver the signup email&quot;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    <span class="co"># expect</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">    expect(<span class="dt">UserMailer</span>).to(receive(<span class="st">:deliver_signup</span>).with(<span class="st">&quot;email@example.com&quot;</span>, <span class="st">&quot;Jimmy Bean&quot;</span>))</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">    <span class="co"># when</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">    post <span class="st">:signup</span>, <span class="st">&quot;Email&quot;</span> =&gt; <span class="st">&quot;email@example.com&quot;</span>, <span class="st">&quot;Name&quot;</span> =&gt; <span class="st">&quot;Jimmy Bean&quot;</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="kw">end</span></a></code></pre></div>
<p>Examples for the #signup method in UserMailer:</p>
<p>```ruby describe “Signup Email” do include EmailSpec::Helpers include EmailSpec::Matchers # include ActionController::UrlWriter - old rails include Rails.application.routes.url_helpers</p>
<p>before(:all) do <span class="citation" data-cites="email">@email</span> = UserMailer.create_signup(“jojo@yahoo.com”, “Jojo Binks”) end</p>
<p>it “should be set to be delivered to the email passed in” do expect(<span class="citation" data-cites="email">@email</span>).to deliver_to(“jojo@yahoo.com”) end</p>
<p>it “should contain the user’s message in the mail body” do expect(<span class="citation" data-cites="email">@email</span>).to have_body_text(/Jojo Binks/) end</p>
</body>
</html>
