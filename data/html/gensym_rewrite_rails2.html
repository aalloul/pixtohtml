<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>gensym_rewrite_rails2</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>As mentioned, RewriteRails will place a <code>.rb</code> in the <code>rewritten</code> directory for each of your <code>.rr</code> files and you can open them up in a text editor. Like any generated file, you should not edit the rewritten files.</p>
<p><strong>My colleagues don’t mind me writing .rr files, but they prefer .rb files. What do we do?</strong></p>
<p>RewriteRails its generated <code>.rb</code> files in its own <code>rewritten</code> directory, and ignores <code>.rb</code> files in Rails’ standard directories. So if your team prefers to have some <code>.rb</code> files and some <code>.rr</code> files, you know that the <code>.rb</code> files in Rails’ standard directories are all ok to edit as you see fit.</p>
<p>In other words, you can write <code>.rb</code> files whenever you want and as long as they are in Rails’ standard directories, they will behave exactly as you expect. You can mix <code>.rb</code> and <code>.rr</code> files as much as you like.</p>
<p><strong>I like this for development, but I don’t want to install all those gems on my server</strong></p>
<ol type="1">
<li>Run <code>rake rewrite:prepare</code>. This will recursively rewrite all of the <code>.rr</code> files in your project so that it is not necessary to run them in production.</li>
<li>Do not install the RewriteRails plugin on your server.</li>
<li>Open up <code>config/environments/production.rb</code> and add the following lines</li>
</ol>
<ul>
<li><code>config.load_paths += %W( #{RAILS_ROOT}/rewritten/app/controllers )</code></li>
<li><code>config.load_paths += %W( #{RAILS_ROOT}/rewritten/app/helpers )</code></li>
<li><code>config.load_paths += %W( #{RAILS_ROOT}/rewritten/app/models )</code></li>
<li><code>config.load_paths += %W( #{RAILS_ROOT}/rewritten/app/lib )</code></li>
<li>…and any other directories where you might place <code>.rr</code> files</li>
</ul>
<p>Now when you run your project in production, the <code>.rr</code> files will not be rewritten on the fly, but Rails will continue to find the rewritten <code>.rb</code> files in the <code>rewritten</code> directory. You don’t have to do anything else, you won’t need ParseTree, Ruby2Ruby, or RewriteRails on your production servers.</p>
<p><strong>How does this differ from the rewrite gem?</strong></p>
<p>Where the rewrite gem allows you to rewrite specific blocks of code and to treat rewriters as first-class entities for meta-meta-programming, <code>RewriteRails</code> simply rewrites entire files with a known set of rewriters.</p>
<p><strong>Why is this better than the rewrite gem?</strong></p>
<p>First, it’s better for you tomorrow. If in the distant future there is some problem that breaks Rewrite (like changes to its dependencies or to MRI), you have your .rb files intact and working.</p>
<p>Second, it’s better for you <em>today</em>. If someone else goes wild with monkey-patching, it won’t break any of your rewritten code.</p>
<p><strong>There must be some reason to prefer rewriting on the fly instead of rewriting files!</strong></p>
<p>Well, if you love abstractions the Rewrite gem treats rewriters as first-class entities and lets you programatically apply them to individual blocks of code at run time. If you can think of a reason why you need that functionality, please get in touch, I’d like to understand the use case.</p>
<p><strong>Do I have to run any rake tasks?</strong></p>
<p>No, RewriteRails rewrites your <code>.rr</code> files on the fly. However, you may wish to run <code>rake rewrite:prepare</code> whenever you wish to inspect what the resulting code will look like without running it. It also might be a nice ides to run it before checking code in, just to be 100% sure your repository has a complete set of the latest <code>.rb</code> files.</p>
<p><strong>That was fun, but we hired a new architect who has decided make his mark by criticizing all of our decisions and insists we stop all new development while we migrate RewriteRails out of our million line project. Are we fuxxored?</strong></p>
<p>Adding a new smartest guy in the room might fuxxor your project for other reasons, but your code is safe with RewriteRails. Run:</p>
<pre><code>rake rewrite:all rewritten=.</code></pre>
<p>This does the <code>prepare</code> task that rewrites all of your code, but instead of placing the resulting <code>.rb</code> files in a hierarchy in the <code>rewritten</code> folder, it places them in your project right next to the <code>.rr</code> files. You can now remove the RewriteRails plugin and your project will work just as if you had never used it. (Removing the out-dated <code>.rr</code> files from the command line shouldn’t be a problem for anyone who values removing technical debt enough to stop all new development.)</p>
<p>The summary is that you can experiment with <code>RewriteRails</code> as much as you like, but you are not painting yourself into a corner. You can escape to standard Ruby at any time. In fact, RewriteRail is all about Standard Ruby. The whole point of the plugin is to always maintain your code using Standard Ruby, it’s just that RewriteRails lets you use powerful idioms to write standard ruby code.</p>
</body>
</html>
