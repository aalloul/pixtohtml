<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>aosp-mirror_platform_bionic6</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>Currently, the list of bionic CTS tests is generated at build time by running a host version of the test executable and dumping the list of all tests. In order for this to continue to work, all architectures must have the same number of tests, and the host version of the executable must also have the same number of tests.</p>
<p>Running the gtests directly is orders of magnitude faster than using CTS, but in cases where you really have to run CTS:</p>
<pre><code>$ make cts # In $ANDROID_ROOT.
$ adb unroot # Because real CTS doesn&#39;t run as root.
# This will sync any *test* changes, but not *code* changes:
$ cts-tradefed \
    run singleCommand cts --skip-preconditions -m CtsBionicTestCases</code></pre>
<h3 id="host-tests">Host tests</h3>
<p>The host tests require that you have <code>lunch</code>ed either an x86 or x86_64 target. Note that due to ABI limitations (specifically, the size of pthread_mutex_t), 32-bit bionic requires PIDs less than 65536. To enforce this, set /proc/sys/kernel/pid_max to 65536.</p>
<pre><code>$ ./tests/run-on-host.sh 32
$ ./tests/run-on-host.sh 64   # For x86_64-bit *targets* only.</code></pre>
<p>You can supply gtest flags as extra arguments to this script.</p>
<h3 id="against-glibc">Against glibc</h3>
<p>As a way to check that our tests do in fact test the correct behavior (and not just the behavior we think is correct), it is possible to run the tests against the host’s glibc.</p>
<pre><code>$ ./tests/run-on-host.sh glibc</code></pre>
<h2 id="gathering-test-coverage">Gathering test coverage</h2>
<p>For either host or target coverage, you must first:</p>
<ul>
<li><code>$ export NATIVE_COVERAGE=true</code>
<ul>
<li>Note that the build system is ignorant to this flag being toggled, i.e. if you change this flag, you will have to manually rebuild bionic.</li>
</ul></li>
<li>Set <code>bionic_coverage=true</code> in <code>libc/Android.mk</code> and <code>libm/Android.mk</code>.</li>
</ul>
<h3 id="coverage-from-device-tests">Coverage from device tests</h3>
<pre><code>$ mma</code></pre>
</body>
</html>
