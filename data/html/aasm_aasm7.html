<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>aasm_aasm7</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h3 id="guards">Guards</h3>
<p>Letâ€™s assume you want to allow particular transitions only if a defined condition is given. For this you can set up a guard per transition, which will run before actually running the transition. If the guard returns <code>false</code> the transition will be denied (raising <code>AASM::InvalidTransition</code> or returning <code>false</code> itself):</p>
<p>```ruby class Cleaner include AASM</p>
<p>aasm do state :idle, :initial =&gt; true state :cleaning</p>
<pre><code>event :clean do
  transitions :from =&gt; :idle, :to =&gt; :cleaning, :guard =&gt; :cleaning_needed?
end

event :clean_if_needed do
  transitions :from =&gt; :idle, :to =&gt; :cleaning do
    guard do
      cleaning_needed?
    end
  end
  transitions :from =&gt; :idle, :to =&gt; :idle
end

event :clean_if_dirty do
  transitions :from =&gt; :idle, :to =&gt; :cleaning, :guard =&gt; :if_dirty?
end</code></pre>
<p>end</p>
<p>def cleaning_needed? false end</p>
<p>def if_dirty?(status) status == :dirty end end</p>
<p>job = Cleaner.new job.may_clean? # =&gt; false job.clean # =&gt; raises AASM::InvalidTransition job.may_clean_if_needed? # =&gt; true job.clean_if_needed! # idle</p>
<p>job.clean_if_dirty(:clean) # =&gt; false</p>
</body>
</html>
