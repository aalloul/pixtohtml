<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>addywaddy_couchsurfer3</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre><code>  …
  view_by :account_id
  …
end

class Project
  …
  view_by :account_id, :email # see validation examples below
  …
end

account = Acccount.create(…)
10.times do
  p = Project.create(…)
  Membership.create(…, :account_id =&gt; account.id, :project_id =&gt; p.id)
end
account.projects</code></pre>
<p><strong>Note on HasManyThrough</strong></p>
<p>With reference to the above example, HasManyThrough works by retrieving all memberships associated with the account, collecting their ids and running a .</p>
<p><em>Caveats</em></p>
<ul>
<li>Sorting needs to be done client side</li>
<li>The results do not contain any extra information that may be present on the ‘:through’ model.</li>
</ul>
<h2 id="validations">Validations</h2>
<p>Validations, with the exception of <code>validates_uniqueness_of</code>, have been implemented using the gem.</p>
<p><strong>Example</strong></p>
<pre><code>class Employee
  include CouchSurfer::Model
  include CouchSurfer::Associations
  include CouchSurfer::Validations

  key_accessor :email, :account_id
  belongs_to :account

  view_by :account_id, :email
  view_by :name

  validates_presence_of :name
  validates_format_of   :email, 
    :with =&gt; /\A([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})\Z/i
  validates_length_of :postcode, :is =&gt; 7, :message =&gt; &quot;not the correct length&quot;
  
  # Will use the Employee.by_name view with {:key =&gt; employee_instance.name}</code></pre>
</body>
</html>
