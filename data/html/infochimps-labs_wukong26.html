<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>infochimps-labs_wukong26</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>The <code>Cat::Runner#run</code> method delegates to the <code>Cat::Driver</code> class to handle instantiating and interacting with processors.</p>
<p>```ruby # in lib/cat/driver.rb module Cat</p>
<p># A class for driving a processor from <code>wu-cat</code>. class Driver</p>
<pre><code># Lets us count the records.
attr_accessor :number

# Gives methods to construct and interact with dataflows.
include Wukong::DriverMethods

# Create a new Driver for a dataflow with the given `label` using
# the given `settings`.
#
# @param [String] label the name of the dataflow
# @param [Configliere::Param] settings the settings to use when creating the dataflow
def initialize label, settings
  self.settings = settings
  self.dataflow = construct_dataflow(label, settings)
  self.number   = 1
end

# The file handle of the input file.
#
# @return [File]
def input_file
  @input_file ||= File.new(settings[:input])
end

# Starts feeding records to the processor
def start
  while line = input_file.readline rescue nil
    driver.send_through_dataflow(line)
  end
end

# Process each record that comes back from the dataflow.
#
# @param [Object] record the yielded record
def process record
  if settings[:number]
    puts [number, record].map(&amp;:to_s).join(&quot;\t&quot;)
  else
    puts record.to_s
  end</code></pre>
</body>
</html>
