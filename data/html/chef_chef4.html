<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>chef_chef4</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>Chef is an amalgam of many components. These components update all the time, necessitating new builds. This is an overview of the process of versioning, building and releasing Chef.</p>
<h2 id="chef-packages">Chef Packages</h2>
<p>Chef is distributed as packages for debian, rhel, ubuntu, windows, solaris, aix, and os x. It includes a large number of components from various sources, and these are versioned and maintained separately from chef project, which bundles them all together conveniently for the user.</p>
<p>These packages go through several milestones: - <code>master</code>: When code is checked in to master, the patch version of chef is bumped (e.g. 0.9.10 -&gt; 0.9.11) and a build is kicked off automatically to create and test the packages in Chef’s Jenkins cluster. - <code>unstable</code>: When a package is built, it enters the unstable channel. When all packages for all OS’s have successfully built, the test phase is kicked off in Jenkins across all supported OS’s. These builds are password-protected and generally only available to the test systems. - <code>current</code>: If the packages pass all the tests on all supported OS’s, it is promoted as a unit to <code>current</code>, and is available via Chef’s artifactory by running <code>curl https://www.chef.io/chef/install.sh | sudo bash -s -- -c current -P chef</code> - <code>stable</code>: Periodically, Chef will pick a release to “bless” for folks who would like a slower update schedule than “every time a build passes the tests.” When this happens, it is manually promoted to stable and an announcement is sent to the list. It can be reached at https://downloads.chef.io or installed using the <code>curl</code> command without specifying <code>-c current</code>. Packages in <code>stable</code> are no longer available in <code>current</code>.</p>
<p>Additionally, periodically Chef will update the desired versions of chef components and check that in to <code>master</code>, triggering a new build with the updated components in it.</p>
<h2 id="automated-version-bumping">Automated Version Bumping</h2>
<p>Whenever a change is checked in to <code>master</code>, the patch version of <code>chef</code> is bumped. To do this, the <code>lita-versioner</code> bot listens to github for merged PRs, and when it finds one, takes these actions:</p>
<ol type="1">
<li>Bumps the patch version in <code>lib/chef/version.rb</code> (e.g. 0.9.14 -&gt; 0.9.15).</li>
<li>Runs <code>rake bundle:install</code> to update the <code>Gemfile.lock</code> to include the new version.</li>
<li>Runs <code>rake changelog:update</code> to update the <code>CHANGELOG.md</code>.</li>
<li>Pushes to <code>master</code> and submits a new build to Chef’s Jenkins cluster.</li>
</ol>
<h2 id="bumping-the-minor-version-of-chef">Bumping the minor version of Chef</h2>
<p>After each “official” stable release we need to bump the minor version. To do this:</p>
<ol type="1">
<li>Run <code>bundle exec rake version:bump_minor</code></li>
</ol>
<p>Submit a PR with the changes made by the above.</p>
<h2 id="addressing-a-regression">Addressing a Regression</h2>
<p>Sometimes, regressions split through the cracks. Since new functionality is always being added and the minor version is bumped immediately after release, we can’t simply roll forward. In this scenario, we’ll need to perform a special regression release process. In the example that follows, the stable release with a regression is <code>1.10.60</code> while master is currently sitting at <code>1.11.30</code>. <em>Note:</em> To perform this process, you must be a Chef employee.</p>
<ol type="1">
<li>If the regression has not already been addressed, open a Pull Request against master with the fix.</li>
<li>Wait until that Pull Request has been merged and <code>1.11.31</code> has passed all the necessary tests and is available in the current channel.</li>
<li>Inspect the Git history and find the <code>SHA</code> associated with the Merge Commit for the Pull Request above.</li>
<li>Apply the fix for the regression via a cherry-pick:</li>
<li>Check out the stable release tag: <code>git checkout v1.10.60</code></li>
<li>Cherry Pick the SHA with the fix: <code>git cherry-pick SHA</code></li>
<li>Address any conflicts (if necessary)</li>
<li>Tag the sha with the appropriate version: <code>git tag -a v1.10.61 -m &quot;Release v1.10.61&quot;</code></li>
<li>Push the new tag to origin: <code>git push origin --tags</code></li>
<li>Log in to Jenkins and trigger a <code>chef-trigger-release</code> job specifying the new tag as the <code>GIT_REF</code>.</li>
</ol>
<h2 id="component-versions">Component Versions</h2>
<p>Chef has two sorts of component: ruby components like <code>berkshelf</code> and <code>test-kitchen</code>, and binary components like <code>openssl</code> and even <code>ruby</code> itself.</p>
</body>
</html>
