<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>kragen_dumbfts4</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h2 id="usage">Usage</h2>
<p>To generate new index segments and skip files for a mailbox:</p>
<pre><code>$ indexmail.py ~/mail/mailbox</code></pre>
<p>To find all messages containing a word beginning with “curt”:</p>
<pre><code>$ fts ~/mail/mailbox curt | less</code></pre>
<p>To find all messages containing the word “curt”:</p>
<pre><code>$ fts ~/mail/mailbox &#39;curt &#39; | less</code></pre>
<p>To find all messages containing the word “curt” in the “From:” header:</p>
<pre><code>$ fts ~/mail/mailbox &#39;curt from &#39; | less</code></pre>
<p>To find all messages containing the words “Curt” and “Martindale” in the “From:” header:</p>
<pre><code>$ fts ~/mail/mailbox &#39;curt from &#39; &#39;martindale from &#39; | less</code></pre>
<p>But you have to manually administer the index to get anything approaching reasonable performance.</p>
<p>The index is in <code>~/mail/mailbox.idx</code>. New index segments are created in this directory with names like “.new-index.segment.6244.1” and atomically renamed to “index-segment.6244.1” once they have been generated. Skip files for them, which are generated automatically, should be in files with the same name, but with “.skip.” at the beginning of their names, like “.skip.index-segment.6244.1”. Sometimes skip files have skip files of their own, with names like “.skip.skip.index-segment.6244.1”.</p>
<p>If you have a whole bunch of index segments and it’s slowing down your searches, you should merge them. Any file in the index directory whose name doesn’t begin with a “.” will be used as an index segment.</p>
<pre><code>$ LANG=C sort -m ~/mail/mailbox.idx/index-segment.* \
              -o ~/mail/mailbox.idx/.new.merged-segment-serno
$ mv ~/mail/mailbox.idx/.new.merged-segment-serno \
     ~/mail/mailbox.idx/merged-segment-serno
$ rm ~/mail/mailbox.idx/index-segment.*</code></pre>
<p>In the third step, make sure you’re only deleting the <code>index-segment.*</code> files that you merged together in the first step.</p>
<p>Then you need to generate skip files for the new merged segments.</p>
</body>
</html>
