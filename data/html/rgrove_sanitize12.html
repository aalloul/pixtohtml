<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>rgrove_sanitize12</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre><code>&lt;/span&gt;
&lt;p&gt;bar&lt;/p&gt;</code></pre>
</header>
<footer>
</footer>
<p>]</p>
<p>transformer = lambda do |env| puts env[:node_name] if env[:node].element? end</p>
<h1 id="prints-header-span-strong-p-footer.">Prints “header”, “span”, “strong”, “p”, “footer”.</h1>
<p>Sanitize.fragment(html, :transformers =&gt; transformer) ```</p>
<p>Transformers have a tremendous amount of power, including the power to completely bypass Sanitize’s built-in filtering. Be careful! Your safety is in your own hands.</p>
<h3 id="example-transformer-to-whitelist-image-urls-by-domain">Example: Transformer to whitelist image URLs by domain</h3>
<p>The following example demonstrates how to remove image elements unless they use a relative URL or are hosted on a specific domain. It assumes that the <code>&lt;img&gt;</code> element and its <code>src</code> attribute are already whitelisted.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" data-line-number="1">require <span class="st">&#39;uri&#39;</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">image_whitelist_transformer = lambda <span class="kw">do</span> |env|</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="co"># Ignore everything except &lt;img&gt; elements.</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="kw">return</span> <span class="kw">unless</span> env[<span class="st">:node_name</span>] == <span class="st">&#39;img&#39;</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  node      = env[<span class="st">:node</span>]</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  image_uri = <span class="dt">URI</span>.parse(node[<span class="st">&#39;src&#39;</span>])</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  <span class="co"># Only allow relative URLs or URLs with the example.com domain. The</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  <span class="co"># image_uri.host.nil? check ensures that protocol-relative URLs like</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">  <span class="co"># &quot;//evil.com/foo.jpg&quot;.</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">  <span class="kw">unless</span> image_uri.host == <span class="st">&#39;example.com&#39;</span> || (image_uri.host.nil? &amp;&amp; image_uri.relative?)</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">    node.unlink <span class="co"># `Nokogiri::XML::Node#unlink` removes a node from the document</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="kw">end</span></a></code></pre></div>
<h3 id="example-transformer-to-whitelist-youtube-video-embeds">Example: Transformer to whitelist YouTube video embeds</h3>
<p>The following example demonstrates how to create a transformer that will safely whitelist valid YouTube video embeds without having to blindly allow other kinds of embedded content, which would be the case if you tried to do this by just whitelisting all <code>&lt;iframe&gt;</code> elements:</p>
</body>
</html>
