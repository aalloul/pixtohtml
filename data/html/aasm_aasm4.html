<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>aasm_aasm4</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre><code>  transitions :from =&gt; :sleeping, :to =&gt; :running, :after =&gt; Proc.new {|*args| set_process(*args) }
  transitions :from =&gt; :running, :to =&gt; :finished, :after =&gt; LogRunTime
end

event :sleep do
  after do
    ...
  end
  error do |e|
    ...
  end
  transitions :from =&gt; :running, :to =&gt; :sleeping
end</code></pre>
<p>end</p>
<p>def log_status_change puts “changing from #{aasm.from_state} to #{aasm.to_state} (event: #{aasm.current_event})” end</p>
<p>def set_process(name) … end</p>
<p>def do_something … end</p>
<p>def notify_somebody … end</p>
<p>end</p>
<p>class LogRunTime def call log “Job was running for X seconds” end end ```</p>
<p>In this case <code>do_something</code> is called before actually entering the state <code>sleeping</code>, while <code>notify_somebody</code> is called after the transition <code>run</code> (from <code>sleeping</code> to <code>running</code>) is finished.</p>
<p>AASM will also initialize <code>LogRunTime</code> and run the <code>call</code> method for you after the transition from <code>running</code> to <code>finished</code> in the example above. You can pass arguments to the class by defining an initialize method on it, like this:</p>
<p>```ruby class LogRunTime # optional args parameter can be omitted, but if you define initialize</p>
</body>
</html>
