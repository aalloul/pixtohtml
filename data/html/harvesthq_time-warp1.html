<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>harvesthq_time-warp1</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h2 id="time-warp">time-warp</h2>
<p>When writing tests, it is often desirable to bend time in order to test limits and edges of the day. It is especially useful to warp time to test results across the timezones of the world. Manipulating time is also useful to assure a day of the week, month or year every time the test runs.</p>
<p>Some may say “Why not just mock <code>Time#now</code>?” I see the point, but I find mocking around with baseline Ruby classes to be asking for trouble. Eventually unusual behavior will rear its head and a day will be lost debugging tests - the most excruciating debugging one can be subjected to.</p>
<h2 id="installation">Installation</h2>
<p>Plugin:</p>
<pre><code>$ script/plugin install git://github.com/harvesthq/time-warp.git</code></pre>
<p>Gem:</p>
<pre><code>$ gem install time-warp</code></pre>
<p>Gem config for a Rails app in <code>config/environment.rb</code>:</p>
<pre><code>config.gem &#39;time-warp&#39;</code></pre>
<h2 id="example">Example</h2>
<p>And now, a contrived example. In this case, the goal is to let the full mechanics of Rails execute. Yes, this test will even hit the database! The goal is to assure a particular day of week when each test method executes:</p>
<pre><code>require File.dirname(__FILE__) + &#39;/../test_helper&#39;
class CompanyTest &lt; Test::Unit::TestCase

  def setup
    @company = companies(:acme)
  end

  def test_should_find_company_needing_reminded_today
    pretend_now_is(Time.utc(2008,&quot;jul&quot;,24,20)) do #=&gt; Thu Jul 24 20:00:00 UTC 2008
      @company.reminder_day = &#39;Thursday&#39;
      @company.save
      companies = Company.find_companies_needing_reminded_today
      assert_equal true, companies.include?(@company)
    end
  end

  def test_should_not_find_company_needing_reminded_tomorrow
    pretend_now_is(Time.utc(2008,&quot;jul&quot;,24,20)) do #=&gt; Thu Jul 24 20:00:00 UTC 2008
      @company.reminder_day = &#39;Friday&#39;
      @company.save
      companies = Company.find_companies_needing_reminded_today
      assert_equal false, companies.include?(@company)
    end</code></pre>
</body>
</html>
