<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>jimweirich_flexmock22</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre><code>  flexmock(Woofer).new_instances do |m|
    m.should_receive(:woof).twice.and_return(:grrr)
    m.should_receive(:wag).at_least.once.and_return(:happy)
  end</code></pre>
<p>```</p>
<h3 id="default-expectations-on-mocks">Default Expectations on Mocks</h3>
<p>Sometimes you want to setup a bunch of default expectations that are pretty much for a number of different tests. Then in the individual tests, you would like to override the default behavior on just that one method you are testing at the moment. You can do that by using the <code>by_default</code> modifier.</p>
<p>In your test setup you might have:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" data-line-number="1">  <span class="kw">def</span> setup</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">    <span class="ot">@mock_dog</span> = flexmock(<span class="st">&quot;Fido&quot;</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    <span class="ot">@mock_dog</span>.should_receive(<span class="st">:tail</span> =&gt; <span class="st">:a_tail</span>, <span class="st">:bark</span> =&gt; <span class="st">&quot;woof&quot;</span>).by_default</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="kw">end</span></a></code></pre></div>
<p>The behaviors for <code>:tail</code> and <code>:bark</code> are good for most of the tests, but perhaps you wish to verify that <code>:bark</code> is called exactly once in a given test. Since :bark by default has no count expectations, you can override the default in the given test.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb3-1" data-line-number="1">  <span class="kw">def</span> test_something_where_bark_must_be_called_once</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    <span class="ot">@mock_dog</span>.should_receive(<span class="st">:bark</span> =&gt; <span class="st">&quot;woof&quot;</span>).once</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    <span class="co"># At this point, the default for :bark is ignored,</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    <span class="co"># and the &quot;woof&quot; value will be returned.</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">    <span class="co"># However, the default for :tail (which returns :a_tail)</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    <span class="co"># is still active.</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">  <span class="kw">end</span></a></code></pre></div>
<p>By setting defaults, your individual tests don’t have to concern themselves with details of all the default setup. But the details of the overrides are right there in the body of the test.</p>
<h3 id="mocking-law-of-demeter-violations">Mocking Law of Demeter Violations</h3>
<p>The Law of Demeter says that you should only invoke methods on objects to which you have a direct connection, e.g. parameters, instance variables, and local variables. You can usually detect Law of Demeter violations by the excessive number of periods in an expression. For</p>
</body>
</html>
