<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>infochimps-labs_wukong4</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre><code>z_score     = (mean - observation) / std_dev
percentile  = 50 * Math.erfc(z_score * SQRT_1_HALF)
yield [observation, percentile].join(&quot;\t&quot;)</code></pre>
<p>end end</p>
<pre><code>
These fields have default values but you can overide them on the
command line.  If you scored a 95 on an exam where the mean score was
80 points and the standard deviation of the scores was 10 points, for
example, then you&#39;d be in the 93rd percentile:
</code></pre>
<p>$ echo 95 | wu-local /tmp/percentile.rb –mean=80 –std_dev=10 95.0 93.3192798731142</p>
<pre><code>
If the exam were more difficult, with a mean of 75 points and a
standard deviation of 8 points, you&#39;d be in the 99th percentile!
</code></pre>
<p>$ echo 95 | wu-local /tmp/percentile.rb –mean=75 –std_dev=8 95.0 99.37903346742239 ```</p>
<h3 id="the-lifecycle-of-a-processor">The Lifecycle of a Processor</h3>
<p>Processors have a lifecycle that they execute when they are run within the context of a Wukong runner like <code>wu-local</code> or <code>wu-hadoop</code>. Each lifecycle phase corresponds to a method of the processor that is called:</p>
<ul>
<li><code>setup</code> called <em>after</em> the Processor is initialized but <em>before</em> the first record is processed. You cannot yield from this method.</li>
<li><code>process</code> called once for each input record, may yield once, many, or no times.</li>
<li><code>finalize</code> called after the the <em>last</em> record has been processed but while the processor still has an opportunity to yield records.</li>
<li><code>stop</code> called to signal to the processor that all work should stop, open connections should be closed, &amp;c. You cannot yield from this method.</li>
</ul>
<p>The above examples have already focused on the <code>process</code> method.</p>
<p>The <code>setup</code> and <code>stop</code> methods are often used together to handle external connections</p>
<p>```ruby # in geolocator.rb Wukong.processor(:geolocator) do field :host, String, :default =&gt; ‘localhost’ attr_accessor :connection</p>
<p>def setup self.connection = Database::Connection.new(host)</p>
</body>
</html>
